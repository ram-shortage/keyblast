---
phase: 10-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Cargo.toml
  - src/logging.rs
  - src/main.rs
  - src/tray.rs
autonomous: true

must_haves:
  truths:
    - "Application logs to rolling file in data directory"
    - "User can click 'Open Logs...' to view log directory"
    - "Logs rotate daily with 7-day retention"
  artifacts:
    - path: "src/logging.rs"
      provides: "Logging initialization with tracing-appender"
      exports: ["init_file_logging", "log_directory"]
    - path: "src/tray.rs"
      provides: "Open Logs menu item"
      contains: "Open Logs"
  key_links:
    - from: "src/main.rs"
      to: "src/logging.rs"
      via: "init_file_logging() call in main()"
      pattern: "init_file_logging"
    - from: "src/tray.rs"
      to: "open::that"
      via: "Open Logs menu handler"
      pattern: "open_logs"
---

<objective>
Add file-based logging with "Open Logs..." menu action.

Purpose: Users need access to logs for troubleshooting. Currently, all output goes to println!/eprintln! which is lost when running as a tray app without console.

Output: Rolling log files in data directory, accessible via tray menu.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ux-polish/10-RESEARCH.md

@Cargo.toml
@src/main.rs
@src/tray.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add logging dependencies and create logging module</name>
  <files>Cargo.toml, src/logging.rs</files>
  <action>
Add dependencies to Cargo.toml:
```toml
tracing = "0.1"
tracing-subscriber = "0.3"
tracing-appender = "0.2"
open = "5.3"
```

Create src/logging.rs with:
- `log_directory()` function returning PathBuf to `{data_dir}/keyblast/logs`
- `init_file_logging()` function that:
  - Creates log directory if needed (create_dir_all)
  - Sets up RollingFileAppender with DAILY rotation
  - Uses filename_prefix "keyblast", suffix "log"
  - Sets max_log_files to 7 (7-day retention)
  - Wraps in non_blocking writer
  - Returns Option<WorkerGuard> (None if setup fails gracefully)
  - Uses try_init() not init() to avoid panic on double-init
  - Disables ANSI colors (with_ansi(false))
- `open_logs_directory()` function that opens log directory with `open::that()`

Reference research pattern for RollingFileAppender builder API.
  </action>
  <verify>
`cargo check` passes. New module compiles.
  </verify>
  <done>
src/logging.rs exists with init_file_logging(), log_directory(), and open_logs_directory() functions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire logging into application and add menu item</name>
  <files>src/main.rs, src/tray.rs</files>
  <action>
In src/main.rs:
- Add `mod logging;` declaration
- In main() BEFORE event loop creation, call `let _log_guard = logging::init_file_logging();`
- Keep guard alive for program lifetime (store in variable that lives until process exit)
- Replace key println! calls with tracing macros:
  - "KeyBlast initializing..." -> info!
  - "Keystroke injector initialized" -> info!
  - "Config loaded from: ..." -> info!
  - "Registered macro: ..." -> debug!
  - Error cases -> error!
  - (Don't need to convert ALL, just demonstrate pattern)

In src/tray.rs:
- Add `open_logs: muda::MenuId` to MenuIds struct
- In build_menu(), add "Open Logs..." MenuItem after "Import Macros..." and before separator
- Store the menu ID in MenuIds

In src/main.rs event handler:
- Add handler for `self.menu_ids.open_logs` that calls `logging::open_logs_directory()`
  </action>
  <verify>
1. `cargo build --release` succeeds
2. Run app, trigger a macro, quit
3. Check `~/Library/Application Support/keyblast/logs/` (macOS) contains keyblast.*.log file
4. Click "Open Logs..." in tray menu - Finder opens log directory
  </verify>
  <done>
- Logs written to rolling files in data directory
- "Open Logs..." menu item opens log directory
- Log files rotate daily, keep 7 days
  </done>
</task>

</tasks>

<verification>
1. Run application and perform actions (toggle, trigger macro, etc.)
2. Quit application
3. Verify log file exists in ~/Library/Application Support/keyblast/logs/ (macOS) or %APPDATA%/keyblast/logs/ (Windows)
4. Verify log contains entries from the session
5. Click "Open Logs..." menu item - system file browser opens log directory
</verification>

<success_criteria>
- UX-03 satisfied: "Open Logs..." menu item works
- Logs persist to rolling files with 7-day retention
- No console output required for troubleshooting
</success_criteria>

<output>
After completion, create `.planning/phases/10-ux-polish/10-01-SUMMARY.md`
</output>
